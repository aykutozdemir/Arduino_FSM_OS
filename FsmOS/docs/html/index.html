<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>FsmOS: FsmOS - Arduino Finite State Machine Operating System</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">FsmOS<span id="projectnumber">&#160;1.3.0</span>
   </div>
   <div id="projectbrief">A lightweight cooperative task scheduler for Arduino</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">FsmOS - Arduino Finite State Machine Operating System </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="md_README"></a> A lightweight, cooperative task scheduler for Arduino that helps you organize your code into independent tasks and manage communication between them. This library is perfect for projects that need to handle multiple operations without blocking or complex interrupt management.</p>
<h1>Key Features</h1>
<ul>
<li><b>Cooperative Multitasking</b>: Run multiple tasks without preemption</li>
<li><b>Message Passing</b>: Inter-task communication with publish/subscribe (type + arg only)</li>
<li><b>Memory Efficient</b>: Optimized for AVR microcontrollers with accurate memory reporting</li>
<li><b>Debug Support</b>: Built-in logging and diagnostics with formatted output</li>
<li><b><a class="el" href="classTask.html" title="Base class for all tasks in FsmOS.">Task</a> Budgeting</b>: Prevent message queue overruns with per-task message budgets</li>
<li><b>Memory Monitoring</b>: Real-time RAM, stack, heap, flash, and EEPROM usage tracking</li>
<li><b>Stack Canary Protection</b>: Automatic stack overflow detection</li>
<li><b>Memory Leak Detection</b>: Built-in memory allocation tracking</li>
<li><b><a class="el" href="classTask.html" title="Base class for all tasks in FsmOS.">Task</a> Limit Control</b>: Configurable maximum task count based on topic bitfield size</li>
</ul>
<h1>Installation</h1>
<h2>Arduino IDE Library Manager (Recommended)</h2>
<ol type="1">
<li>Open Arduino IDE</li>
<li>Go to <code>Sketch &gt; Include Library &gt; Manage Libraries...</code></li>
<li>Search for "FsmOS"</li>
<li>Click Install</li>
</ol>
<h2>Manual Installation</h2>
<ol type="1">
<li>Download this repository</li>
<li>Copy the <code>FsmOS</code> folder to your Arduino libraries directory</li>
<li>Restart Arduino IDE</li>
</ol>
<h1>Quick Start</h1>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="FsmOS_8h.html">FsmOS.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Define a simple blinking task</span></div>
<div class="line"><span class="keyword">class </span>BlinkTask : <span class="keyword">public</span> <a class="code hl_class" href="classTask.html">Task</a></div>
<div class="line">{</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">    BlinkTask() : <a class="code hl_class" href="classTask.html">Task</a>(F(<span class="stringliteral">&quot;Blinker&quot;</span>))</div>
<div class="line">    {</div>
<div class="line">        set_period(500);  <span class="comment">// Run every 500ms</span></div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    uint8_t <a class="code hl_function" href="group__fsmos.html#gadf715a30a3759bfd0856f12cfdf29d0e">getMaxMessageBudget</a>()<span class="keyword"> const override </span>{ <span class="keywordflow">return</span> 0; }</div>
<div class="line">    uint16_t <a class="code hl_function" href="classTask.html#aea07a4be09d08cb8b1afa1914ddc988c">getTaskStructSize</a>()<span class="keyword"> const override </span>{ <span class="keywordflow">return</span> <span class="keyword">sizeof</span>(*this); }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> <a class="code hl_function" href="classTask.html#a05ad697fe4c99793e7af4dade75bad64">on_start</a>()<span class="keyword"> override</span></div>
<div class="line"><span class="keyword">    </span>{</div>
<div class="line">        pinMode(LED_BUILTIN, OUTPUT);</div>
<div class="line">        <a class="code hl_function" href="classTask.html#a24f4e032e0dd55e6e2e7ef44c715e9ca">logInfo</a>(F(<span class="stringliteral">&quot;Blink task started&quot;</span>));</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> <a class="code hl_function" href="classTask.html#a399ff82ffe4b94a11cd8148987e38622">step</a>()<span class="keyword"> override</span></div>
<div class="line"><span class="keyword">    </span>{</div>
<div class="line">        digitalWrite(LED_BUILTIN, !digitalRead(LED_BUILTIN));</div>
<div class="line">    }</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line">BlinkTask blinker;</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> setup()</div>
<div class="line">{</div>
<div class="line">    Serial.begin(9600);</div>
<div class="line">    <a class="code hl_variable" href="group__fsmos.html#ga990d37c1e9d0a35fead6ab92e0da955e">OS</a>.begin_with_logger();  <span class="comment">// Initialize with logging</span></div>
<div class="line">    <a class="code hl_variable" href="group__fsmos.html#ga990d37c1e9d0a35fead6ab92e0da955e">OS</a>.<a class="code hl_function" href="classScheduler.html#a278e9940ce3dd1c708c5bd55b0e4059b">add</a>(&amp;blinker);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> loop()</div>
<div class="line">{</div>
<div class="line">    <a class="code hl_variable" href="group__fsmos.html#ga990d37c1e9d0a35fead6ab92e0da955e">OS</a>.loop_once();</div>
<div class="line">}</div>
<div class="ttc" id="aFsmOS_8h_html"><div class="ttname"><a href="FsmOS_8h.html">FsmOS.h</a></div><div class="ttdoc">A lightweight cooperative task scheduler for Arduino.</div></div>
<div class="ttc" id="aclassScheduler_html_a278e9940ce3dd1c708c5bd55b0e4059b"><div class="ttname"><a href="classScheduler.html#a278e9940ce3dd1c708c5bd55b0e4059b">Scheduler::add</a></div><div class="ttdeci">bool add(Task *task)</div><div class="ttdoc">Add a task to the scheduler.</div><div class="ttdef"><b>Definition</b> <a href="FsmOS_8cpp_source.html#l00783">FsmOS.cpp:783</a></div></div>
<div class="ttc" id="aclassTask_html"><div class="ttname"><a href="classTask.html">Task</a></div><div class="ttdoc">Base class for all tasks in FsmOS.</div><div class="ttdef"><b>Definition</b> <a href="FsmOS_8h_source.html#l00653">FsmOS.h:654</a></div></div>
<div class="ttc" id="aclassTask_html_a05ad697fe4c99793e7af4dade75bad64"><div class="ttname"><a href="classTask.html#a05ad697fe4c99793e7af4dade75bad64">Task::on_start</a></div><div class="ttdeci">virtual void on_start()</div><div class="ttdoc">Called when task is started.</div><div class="ttdef"><b>Definition</b> <a href="FsmOS_8h_source.html#l00680">FsmOS.h:680</a></div></div>
<div class="ttc" id="aclassTask_html_a24f4e032e0dd55e6e2e7ef44c715e9ca"><div class="ttname"><a href="classTask.html#a24f4e032e0dd55e6e2e7ef44c715e9ca">Task::logInfo</a></div><div class="ttdeci">void logInfo(const __FlashStringHelper *msg)</div><div class="ttdoc">Log an info message.</div><div class="ttdef"><b>Definition</b> <a href="FsmOS_8cpp_source.html#l00568">FsmOS.cpp:568</a></div></div>
<div class="ttc" id="aclassTask_html_a399ff82ffe4b94a11cd8148987e38622"><div class="ttname"><a href="classTask.html#a399ff82ffe4b94a11cd8148987e38622">Task::step</a></div><div class="ttdeci">virtual void step()=0</div><div class="ttdoc">Main task execution method.</div></div>
<div class="ttc" id="aclassTask_html_aea07a4be09d08cb8b1afa1914ddc988c"><div class="ttname"><a href="classTask.html#aea07a4be09d08cb8b1afa1914ddc988c">Task::getTaskStructSize</a></div><div class="ttdeci">virtual uint16_t getTaskStructSize() const</div><div class="ttdoc">Get the size in bytes of the concrete task object.</div><div class="ttdef"><b>Definition</b> <a href="FsmOS_8h_source.html#l00807">FsmOS.h:807</a></div></div>
<div class="ttc" id="agroup__fsmos_html_ga990d37c1e9d0a35fead6ab92e0da955e"><div class="ttname"><a href="group__fsmos.html#ga990d37c1e9d0a35fead6ab92e0da955e">OS</a></div><div class="ttdeci">Scheduler OS</div><div class="ttdoc">Global scheduler instance.</div><div class="ttdef"><b>Definition</b> <a href="FsmOS_8cpp_source.html#l00048">FsmOS.cpp:48</a></div></div>
<div class="ttc" id="agroup__fsmos_html_gadf715a30a3759bfd0856f12cfdf29d0e"><div class="ttname"><a href="group__fsmos.html#gadf715a30a3759bfd0856f12cfdf29d0e">Task::getMaxMessageBudget</a></div><div class="ttdeci">virtual uint8_t getMaxMessageBudget() const</div><div class="ttdoc">Get the maximum number of messages this task may produce in one step()</div><div class="ttdef"><b>Definition</b> <a href="FsmOS_8h_source.html#l00801">FsmOS.h:801</a></div></div>
</div><!-- fragment --><h1>Examples</h1>
<p>Check the <code>examples</code> folder for more demonstrations:</p><ul>
<li><code>BasicBlink</code>: Simple LED blinking task</li>
<li><code>ButtonLed</code>: Inter-task communication with publish/subscribe</li>
<li><code>Diagnostics</code>: System monitoring and debugging</li>
<li><code>Logger</code>: Using the built-in logging system with different levels</li>
<li><code>MemoryMonitoring</code>: Comprehensive memory usage tracking</li>
<li><code>MemoryOptimization</code>: Memory-efficient coding practices</li>
<li><code>MemoryOptimizedTimers</code>: Timer usage optimization</li>
<li><code>MessageQueueing</code>: Message handling during task suspension</li>
<li><code>TaskLifecycle</code>: <a class="el" href="classTask.html" title="Base class for all tasks in FsmOS.">Task</a> state management</li>
<li><code>DynamicTasks</code>: Runtime task creation/deletion</li>
<li><code>TaskNames</code>: Named tasks and state tracking</li>
<li><code>MutexExample</code>: Mutual exclusion synchronization</li>
<li><code>SemaphoreExample</code>: Semaphore-based synchronization</li>
<li><code>TaskTimingMonitoring</code>: <a class="el" href="classTask.html" title="Base class for all tasks in FsmOS.">Task</a> execution timing analysis</li>
</ul>
<h1>Key Concepts</h1>
<h2><a class="el" href="classTask.html" title="Base class for all tasks in FsmOS.">Task</a> Structure</h2>
<p>Every task must implement two pure virtual methods: </p><div class="fragment"><div class="line">uint8_t getMaxMessageBudget()<span class="keyword"> const override </span>{ <span class="keywordflow">return</span> X; }  <span class="comment">// Max messages per step</span></div>
<div class="line">uint16_t getTaskStructSize()<span class="keyword"> const override </span>{ <span class="keywordflow">return</span> <span class="keyword">sizeof</span>(*this); }  <span class="comment">// Memory tracking</span></div>
</div><!-- fragment --><h2>Message System</h2>
<p>FsmOS uses a simplified message system with only type and argument data: </p><div class="fragment"><div class="line"><span class="comment">// Publish a message</span></div>
<div class="line">publish(TOPIC_LED_EVENTS, EVT_LED_ON, 1);  <span class="comment">// topic, type, arg</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Handle messages</span></div>
<div class="line"><span class="keywordtype">void</span> on_msg(<span class="keyword">const</span> MsgData &amp;msg)<span class="keyword"> override</span></div>
<div class="line"><span class="keyword"></span>{</div>
<div class="line">    <span class="keywordflow">switch</span> (msg.type)</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">case</span> EVT_LED_ON:</div>
<div class="line">            digitalWrite(LED_PIN, msg.arg);</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><h2>Message Budgeting</h2>
<p>Tasks declare their maximum message production budget. The scheduler ensures sufficient queue space before execution: </p><div class="fragment"><div class="line"><span class="comment">// Button task that publishes events</span></div>
<div class="line">uint8_t getMaxMessageBudget()<span class="keyword"> const override </span>{ <span class="keywordflow">return</span> 2; }  <span class="comment">// Press + Release</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// LED task that only receives</span></div>
<div class="line">uint8_t getMaxMessageBudget()<span class="keyword"> const override </span>{ <span class="keywordflow">return</span> 1; }  <span class="comment">// Minimal</span></div>
</div><!-- fragment --><h2>Memory Monitoring</h2>
<p>Access comprehensive memory information: </p><div class="fragment"><div class="line"><a class="code hl_struct" href="structSystemMemoryInfo.html">SystemMemoryInfo</a> info;</div>
<div class="line"><a class="code hl_variable" href="group__fsmos.html#ga990d37c1e9d0a35fead6ab92e0da955e">OS</a>.<a class="code hl_function" href="classScheduler.html#a7c61b8b908a19416283e66c0fb076a40">getSystemMemoryInfo</a>(info);</div>
<div class="line"><span class="comment">// info.freeRam, info.stackUsed, info.flashUsed, info.eepromUsed, etc.</span></div>
<div class="ttc" id="aclassScheduler_html_a7c61b8b908a19416283e66c0fb076a40"><div class="ttname"><a href="classScheduler.html#a7c61b8b908a19416283e66c0fb076a40">Scheduler::getSystemMemoryInfo</a></div><div class="ttdeci">bool getSystemMemoryInfo(SystemMemoryInfo &amp;info)</div><div class="ttdoc">Get system memory information.</div><div class="ttdef"><b>Definition</b> <a href="FsmOS_8cpp_source.html#l01524">FsmOS.cpp:1524</a></div></div>
<div class="ttc" id="astructSystemMemoryInfo_html"><div class="ttname"><a href="structSystemMemoryInfo.html">SystemMemoryInfo</a></div><div class="ttdoc">System memory information.</div><div class="ttdef"><b>Definition</b> <a href="FsmOS_8h_source.html#l00196">FsmOS.h:197</a></div></div>
</div><!-- fragment --><h2>Formatted Logging</h2>
<p>Use memory-efficient formatted logging: </p><div class="fragment"><div class="line"><a class="code hl_function" href="group__fsmos.html#gac6c8dbf1f133ab906d0f3490e0de5d74">logDebugf</a>(F(<span class="stringliteral">&quot;Value: %d, Status: %s&quot;</span>), value, status);</div>
<div class="line"><a class="code hl_function" href="group__fsmos.html#ga0fd80592a7d1d2fd9b1b52081a8d69cb">logInfof</a>(F(<span class="stringliteral">&quot;Operation %d complete&quot;</span>), operation_id);</div>
<div class="line"><a class="code hl_function" href="group__fsmos.html#ga58264bc1f779d2cd6cb6a8c733a17a21">logWarnf</a>(F(<span class="stringliteral">&quot;Low memory: %d bytes&quot;</span>), free_memory);</div>
<div class="line"><a class="code hl_function" href="group__fsmos.html#gade3c130d653bf887af5b2f6120f388ad">logErrorf</a>(F(<span class="stringliteral">&quot;Failed after %d attempts&quot;</span>), attempts);</div>
<div class="ttc" id="agroup__fsmos_html_ga0fd80592a7d1d2fd9b1b52081a8d69cb"><div class="ttname"><a href="group__fsmos.html#ga0fd80592a7d1d2fd9b1b52081a8d69cb">logInfof</a></div><div class="ttdeci">void logInfof(const __FlashStringHelper *format,...)</div><div class="ttdoc">Log an info message with formatting.</div><div class="ttdef"><b>Definition</b> <a href="FsmOS_8cpp_source.html#l01703">FsmOS.cpp:1703</a></div></div>
<div class="ttc" id="agroup__fsmos_html_ga58264bc1f779d2cd6cb6a8c733a17a21"><div class="ttname"><a href="group__fsmos.html#ga58264bc1f779d2cd6cb6a8c733a17a21">logWarnf</a></div><div class="ttdeci">void logWarnf(const __FlashStringHelper *format,...)</div><div class="ttdoc">Log a warning message with formatting.</div><div class="ttdef"><b>Definition</b> <a href="FsmOS_8cpp_source.html#l01711">FsmOS.cpp:1711</a></div></div>
<div class="ttc" id="agroup__fsmos_html_gac6c8dbf1f133ab906d0f3490e0de5d74"><div class="ttname"><a href="group__fsmos.html#gac6c8dbf1f133ab906d0f3490e0de5d74">logDebugf</a></div><div class="ttdeci">void logDebugf(const __FlashStringHelper *format,...)</div><div class="ttdoc">Default per-task message production budget.</div><div class="ttdef"><b>Definition</b> <a href="FsmOS_8cpp_source.html#l01695">FsmOS.cpp:1695</a></div></div>
<div class="ttc" id="agroup__fsmos_html_gade3c130d653bf887af5b2f6120f388ad"><div class="ttname"><a href="group__fsmos.html#gade3c130d653bf887af5b2f6120f388ad">logErrorf</a></div><div class="ttdeci">void logErrorf(const __FlashStringHelper *format,...)</div><div class="ttdoc">Log an error message with formatting.</div><div class="ttdef"><b>Definition</b> <a href="FsmOS_8cpp_source.html#l01719">FsmOS.cpp:1719</a></div></div>
</div><!-- fragment --><h1>Configuration Parameters</h1>
<h2>Stack Canary Protection</h2>
<div class="fragment"><div class="line"><span class="preprocessor">#ifndef FSMOS_STACK_CANARY_MARGIN</span></div>
<div class="line"><span class="preprocessor">#define FSMOS_STACK_CANARY_MARGIN 32  </span><span class="comment">// Safety margin in bytes</span></div>
<div class="line"><span class="preprocessor">#endif</span></div>
</div><!-- fragment --><h2>Topic Bitfield Size</h2>
<div class="fragment"><div class="line"><span class="preprocessor">#ifndef TOPIC_BITFIELD_SIZE</span></div>
<div class="line"><span class="preprocessor">#define TOPIC_BITFIELD_SIZE 16  </span><span class="comment">// 8, 16, or 32 topics max</span></div>
<div class="line"><span class="preprocessor">#endif</span></div>
</div><!-- fragment --><h2>Message Pool Size</h2>
<div class="fragment"><div class="line"><span class="preprocessor">#ifndef MAX_MESSAGE_POOL_SIZE</span></div>
<div class="line"><span class="preprocessor">#define MAX_MESSAGE_POOL_SIZE 32  </span><span class="comment">// Maximum messages in pool</span></div>
<div class="line"><span class="preprocessor">#endif</span></div>
</div><!-- fragment --><h2>Default Values</h2>
<div class="fragment"><div class="line"><span class="keyword">const</span> uint8_t <a class="code hl_variable" href="group__fsmos.html#ga5c3f1eb0aa79f56d91fdbf8fd9f1b911">DEFAULT_TASK_MESSAGE_BUDGET</a> = 1;  <span class="comment">// Messages per step</span></div>
<div class="line"><span class="keyword">const</span> uint16_t <a class="code hl_variable" href="group__fsmos.html#gac154c550db4c5b7fed1b1fd1e31a63ee">DEFAULT_TASK_PERIOD</a> = 100;       <span class="comment">// Default period in ms</span></div>
<div class="ttc" id="agroup__fsmos_html_ga5c3f1eb0aa79f56d91fdbf8fd9f1b911"><div class="ttname"><a href="group__fsmos.html#ga5c3f1eb0aa79f56d91fdbf8fd9f1b911">DEFAULT_TASK_MESSAGE_BUDGET</a></div><div class="ttdeci">const uint8_t DEFAULT_TASK_MESSAGE_BUDGET</div><div class="ttdoc">Base class for all tasks in FsmOS.</div><div class="ttdef"><b>Definition</b> <a href="FsmOS_8h_source.html#l00648">FsmOS.h:648</a></div></div>
<div class="ttc" id="agroup__fsmos_html_gac154c550db4c5b7fed1b1fd1e31a63ee"><div class="ttname"><a href="group__fsmos.html#gac154c550db4c5b7fed1b1fd1e31a63ee">DEFAULT_TASK_PERIOD</a></div><div class="ttdeci">const uint16_t DEFAULT_TASK_PERIOD</div><div class="ttdoc">Default task period in milliseconds.</div><div class="ttdef"><b>Definition</b> <a href="FsmOS_8h_source.html#l01515">FsmOS.h:1515</a></div></div>
</div><!-- fragment --><h1>Memory Optimization Features</h1>
<h2>Stack Canary</h2>
<ul>
<li>Automatic stack overflow detection</li>
<li>Configurable safety margin</li>
<li>Marks entire free RAM region between heap and stack</li>
</ul>
<h2>Memory Leak Detection</h2>
<ul>
<li>Tracks all memory allocations and deallocations</li>
<li>Provides peak usage and current usage statistics</li>
<li>Always active (no conditional compilation)</li>
</ul>
<h2><a class="el" href="classTask.html" title="Base class for all tasks in FsmOS.">Task</a> Limit Control</h2>
<ul>
<li>Prevents adding more tasks than <code>MAX_TOPICS</code> allows</li>
<li>Runtime logging and rejection of excess tasks</li>
<li>Based on <code>TOPIC_BITFIELD_SIZE</code> configuration</li>
</ul>
<h2>Message Data Optimization</h2>
<ul>
<li>Simplified message structure (type + arg only)</li>
<li>No dynamic data allocation for messages</li>
<li>Reduced memory footprint per message</li>
</ul>
<h1>Platformio Configuration</h1>
<p>For optimal performance with Arduino Nano, use these build flags: </p><div class="fragment"><div class="line">build_flags =</div>
<div class="line">  -Os                    # Size optimization</div>
<div class="line">  -ffunction-sections    # Function sectioning</div>
<div class="line">  -fdata-sections       # Data sectioning</div>
<div class="line">  -fno-exceptions       # Remove exception handling</div>
<div class="line">  -DTOPIC_BITFIELD_SIZE=16  # Topic bitfield size</div>
<div class="line">  -Wl,--gc-sections     # Dead code elimination</div>
<div class="line">  -fno-lto              # Disable LTO</div>
<div class="line">  -DNDEBUG              # Remove debug symbols</div>
<div class="line">  -mmcu=atmega328p      # AVR architecture</div>
<div class="line">  -fno-stack-protector  # Reduce stack usage</div>
<div class="line">  -fpack-struct=1       # Memory alignment</div>
<div class="line">  -DFSMOS_FLASH_SIZE=30720  # Flash size</div>
<div class="line">  -DFSMOS_EEPROM_SIZE=1024  # EEPROM size</div>
</div><!-- fragment --><h1>Memory Usage</h1>
<p>Typical memory usage on Arduino Nano (ATmega328P):</p><ul>
<li><b>RAM</b>: ~1.3KB (64% of 2KB)</li>
<li><b>Flash</b>: ~29KB (95% of 30KB)</li>
<li><b>Message Pool</b>: 32 messages × 5 bytes = 160 bytes</li>
<li><b>Stack Canary</b>: 32 bytes safety margin</li>
</ul>
<h1>API Reference</h1>
<h2>Core Functions</h2>
<ul>
<li><code>OS.begin()</code> - Initialize scheduler</li>
<li><code>OS.begin_with_logger()</code> - Initialize with logging</li>
<li><code>OS.add(task)</code> - Add task to scheduler</li>
<li><code>OS.loop_once()</code> - Run one scheduler cycle</li>
<li><code>OS.getTaskCount()</code> - Get current task count</li>
<li><code>OS.getFreeMemory()</code> - Get free RAM</li>
</ul>
<h2><a class="el" href="classTask.html" title="Base class for all tasks in FsmOS.">Task</a> Methods</h2>
<ul>
<li><code>set_period(ms)</code> - Set task period</li>
<li><code>set_priority(level)</code> - Set task priority</li>
<li><code>publish(topic, type, arg)</code> - Publish message</li>
<li><code>subscribe(topic)</code> - Subscribe to topic</li>
<li><code>logInfo(msg)</code> - Log info message</li>
<li><code>logDebug(msg)</code> - Log debug message</li>
<li><code>logWarn(msg)</code> - Log warning message</li>
<li><code>logError(msg)</code> - Log error message</li>
</ul>
<h2>Memory Functions</h2>
<ul>
<li><code>OS.getSystemMemoryInfo(info)</code> - Get comprehensive memory info</li>
<li><code>OS.getMemoryStats()</code> - Get memory allocation statistics</li>
<li><code>OS.getTaskStats()</code> - Get task execution statistics</li>
</ul>
<h1>Troubleshooting</h1>
<h2>Common Issues</h2>
<ol type="1">
<li><b><a class="el" href="classTask.html" title="Base class for all tasks in FsmOS.">Task</a> limit reached</b>: Reduce <code>TOPIC_BITFIELD_SIZE</code> or optimize task count</li>
<li><b>Memory overflow</b>: Check stack canary warnings and reduce memory usage</li>
<li><b>Message queue full</b>: Increase <code>MAX_MESSAGE_POOL_SIZE</code> or optimize message budgets</li>
<li><b>Compilation errors</b>: Ensure all required methods are implemented</li>
</ol>
<h2>Debug Commands</h2>
<p>Use serial commands for debugging:</p><ul>
<li><code>s</code> - System statistics</li>
<li><code>mem</code> - Memory information</li>
<li><code>tl</code> - <a class="el" href="classTask.html" title="Base class for all tasks in FsmOS.">Task</a> limit check</li>
<li><code>st</code> - <a class="el" href="classTask.html" title="Base class for all tasks in FsmOS.">Task</a> status</li>
</ul>
<h1>Contributing</h1>
<ol type="1">
<li>Fork the repository</li>
<li>Create your feature branch</li>
<li>Commit your changes</li>
<li>Push to the branch</li>
<li>Create a Pull Request</li>
</ol>
<h1>License</h1>
<p>This project is licensed under the MIT License. See the LICENSE file for details.</p>
<h1>Changelog</h1>
<h2>Version 1.3.0</h2>
<ul>
<li>Removed message data system for memory optimization</li>
<li>Enhanced stack canary protection</li>
<li>Added task limit control</li>
<li>Improved memory leak detection</li>
<li>Optimized message structure (type + arg only)</li>
<li>Reduced memory footprint per message by 7 bytes </li>
</ul>
</div></div><!-- PageDoc -->
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8
</small></address>
</body>
</html>
